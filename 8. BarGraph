pd_rarefy <- psmelt(phylo_rarefy_top50_ratio)
# head(pd_rarefy)
# str(pd_rarefy)
# write.csv(pd_rarefy,"pd_rarefy.csv")
W0_Family <-
ggplot(pd_rarefy[(pd_rarefy$Source == 0),], aes(x=TreatmentWeek, y=Abundance, fill=Family)) +
    geom_bar(stat="identity") +
 theme(axis.title.y = element_blank(), 
        axis.text.y = element_text(size=8,angle=0,hjust=0.5,vjust=0.5,color="Black"),
        axis.text.x = element_text(size=8,color="Black"),
        axis.ticks = element_blank(),
        legend.text = element_text(size = 10),
        legend.key.size = unit(0.5, "cm"),legend.key.height = unit(0.5, "cm")
        )+
facet_wrap(~Family, nrow=3) +
  coord_flip()
W0_Family

#pd_rarefy[] allows you to choose part of the data to graph (you can also use filter %>%)
#x could be SampleID, or TreatmentWeek, or Week, anything. It will aggregate the info. 
#fill could be Genus, in which case each bar will have multiple colors, it shows the distribution of each Genus. 


#optional below. Just to show what happens when you don't rarefy. 
pd_all_OTU <- psmelt(phylo_ratio)

ggplot(pd_all_OTU, aes(x=TreatmentWeek, y=Abundance, fill=Family)) +
    geom_bar(stat="identity") +
 theme(axis.title.y = element_blank(), 
        axis.text.y = element_text(size=8,angle=0,hjust=0.5,vjust=0.5,color="Black"),
        axis.text.x = element_text(size=8,color="Black"),
        axis.ticks = element_blank(),
        
        legend.text = element_text(size = 10),
        legend.key.size = unit(0.5, "cm"),legend.key.height = unit(0.5, "cm")
        )+
facet_wrap(~Family, nrow=3) +
  coord_flip()
