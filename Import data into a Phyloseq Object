# Read Metadata
metadata<-read_q2metadata("metadata.txt")
  head(metadata)

# Read OTU table, fan be directly from .qza file or .tsv file
OTUs<-read_qza("rarefied_table.qza")
  OTUs$data[1:10,1:15] #show first 10 taxa within first 15 samples

# Read Taxonomy
taxonomy<-read_qza("taxonomy.qza")
head(taxonomy$data)

#We can also import these data from txt or excel files rather than Qiime2. The goal is to create Phyloseq object. See: https://vaulot.github.io/tutorials/Phyloseq_tutorial.html

#Creating a Phyloseq Object
phylo<-qza_to_phyloseq(
  features="rarefied_table.qza",
  tree="rooted-tree.qza",
  "taxonomy.qza",
  metadata = "metadata.txt")
phylo
#Here we created an object named phylo, which is a matrix contains sample ID and metadata info, abundance of each OTU in each sample, and their taxonomy information.

#below we are listing different parameters of 'phylo':
require(phyloseq)
rank_names(phylo) 
sample_variables(phylo)
sample_names(phylo)
get_taxa_unique(phylo, "Family")[1:10]
tax_table(phylo)[1:10] 
levels(sample_data(phylo)$group)
levels(sample_data(phylo)$Genotype)

#group and Genotype are the columns from the metadata file.

#check the value of the following
#phyloseq-class experiment-level object
#otu_table()   OTU Table:         [ 353 taxa and 39 samples ]
#sample_data() Sample Data:       [ 39 samples by 8 sample variables ]
#tax_table()   Taxonomy Table:    [ 353 taxa by 7 taxonomic ranks ]
#phy_tree()    Phylogenetic Tree: [ 353 tips and 351 internal nodes ]
 
#rank_names(phylo) 
# [1] "Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus"   "Species"
# sample_variables(phylo)
# [1] "Group"         "Source"        "EarTag"        "GroupByTreat" 
# [5] "GroupBySample" "GroupWeek"     "Genotype"      "Treatment"    
# sample_names(phylo)
# [1] "A5267-4"    "A5267-6"    "A5267-8"    "A5272-4"    "A5272-6"    "A5272-8"   

> get_taxa_unique(phylo, "Family")
#[1] NA                       "Acetobacteraceae"       "Alcaligenaceae"        
#[4] "Enterobacteriaceae"     "Verrucomicrobiaceae"    "F16"                   
#[7] "Bifidobacteriaceae"     "Coriobacteriaceae"      "Dehalobacteriaceae"    
#levels(sample_data(phylo)$Treatment)
#[1] "IL10-B.frag" "IL10-SPF"
# If any of the above is "NULL" check the original file. 
