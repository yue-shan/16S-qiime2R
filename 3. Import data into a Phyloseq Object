require(qiime2r)

# Read Metadata
metadata<-read_q2metadata("metadata.txt")
  head(metadata)

# Read OTU table, fan be directly from .qza file or .tsv file
OTUs<-read_qza("rarefied_table.qza")
  OTUs$data[1:10,1:15] #show first 10 taxa within first 15 samples

# Read Taxonomy
taxonomy<-read_qza("taxonomy.qza")
head(taxonomy$data)

#We can also import these data from txt or excel files rather than Qiime2. The goal is to create Phyloseq object. See: https://vaulot.github.io/tutorials/Phyloseq_tutorial.html

#Creating a Phyloseq Object
phylo<-qza_to_phyloseq(
  features="rarefied_table.qza",
  tree="rooted-tree.qza",
  "taxonomy.qza",
  metadata = "metadata.txt")
phylo
#Here we created an object named phylo, which is a matrix contains sample ID and metadata info, abundance of each OTU in each sample, and their taxonomy information.

require(phyloseq)
#below we name different elements of 'phylo':
rank_names(phylo) 
sample_variables(phylo)
sample_names(phylo)
get_taxa_unique(phylo, "Family")[1:10]
tax_table(phylo)[1:10] 
sample_data(Phylo)


levels(sample_data(phylo)$TreatmentWeek)
levels(sample_data(phylo)$Genotype)
# The levels are ordered alphabetically. You can reorganize the order of the levels by define a new vector for them. For example, new -> c(sample_data(phylo)$TreatmentWeek, levels = c("a","b")).

#group and Genotype are the columns from the metadata file.

#check the value of the the above parameter
# If any of the above is "NULL" check the original file. 
